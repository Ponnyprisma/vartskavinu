function addInfoWindow(a,b){var c=new google.maps.InfoWindow({content:b});return a.addListener('click',function(){c.open(a.get('map'),a)}),c}function showRightClickPopup(a){var b;$('.rightclickpopup').remove(),b=document.createElement('div'),b.className='rightclickpopup',b.innerHTML='<a class="rightclickpopup_link" id="place_marker" href="#">Placera markör</a>',$(map.getDiv()).append(b),setMenuXY(a),b.style.visibility='visible'}function getCanvasXY(a){var b=Math.pow(2,map.getZoom()),c=new google.maps.LatLng(map.getBounds().getNorthEast().lat(),map.getBounds().getSouthWest().lng()),d=map.getProjection().fromLatLngToPoint(c),e=map.getProjection().fromLatLngToPoint(a),f=new google.maps.Point(Math.floor((e.x-d.x)*b),Math.floor((e.y-d.y)*b));return f}function setMenuXY(a){var b=$(map.getDiv()).width(),c=$(map.getDiv()).height(),d=$('.rightclickpopup').width(),e=$('.rightclickpopup').height(),f=getCanvasXY(a),g=f.x,h=f.y;d>b-g&&(g-=d),e>c-h&&(h-=e),$('.rightclickpopup').css('left',g),$('.rightclickpopup').css('top',h)}function setMovableMarker(a){var b;movable_marker&&movable_marker.setMap(null),movable_marker=new google.maps.Marker({position:a,map:map,draggable:!0,icon:personMarker}),geocoder.geocode({location:a},function(a,c){if(c!==google.maps.GeocoderStatus.OK)return console.error(c),!1;if(a[2]){var d=a[2].formatted_address;b=addInfoWindow(movable_marker,createMovableMarkerBtn(d)),b.open(map,movable_marker)}else alert('Ingen address hittad!')}),google.maps.event.addListener(movable_marker,'dragend',function(a){geocoder.geocode({location:a.latLng},function(a,c){if(c!==google.maps.GeocoderStatus.OK)return console.error(c),!1;if(a[2]){var d=a[2].formatted_address;b.setContent(createMovableMarkerBtn(d))}else alert('Ingen address hittad!')})})}function createMovableMarkerBtn(a){var b='';return b+='<p><strong>Hittad adress</strong><br />'+a+'</p>',b+='<a href="#" class="btn btn-primary btn-sm btn-block" id="place_marker">Placera markör</a>'}function createStaticMarkerContent(a,b){var c='';return c+='<div class="static-marker-content">',c+='<p><strong>'+b+'</strong></p>',c+='<a href="#" class="delete-marker" data-target="'+(a-1)+'">Radera markör</a>',c+='</div>'}function addStaticMarker(a,b){var c=new google.maps.Marker({position:a,map:map,icon:standardMarker,animation:google.maps.Animation.DROP,draggable:!0});markers.push(c);var d=markers.length;updateMarkerTitles(markers);var e=addInfoWindow(c,createStaticMarkerContent(d,b));addToPath(a),c.addListener('dragend',function(a){updatePath(markers),updateLocation(e,a.latLng,d)}),c.addListener('drag',function(a){path.setOptions({strokeOpacity:.2})})}function addLocation(a){function b(b,c){if(c!==google.maps.GeocoderStatus.OK)return console.error(c),!1;if(b[2]){var d=b[2].formatted_address;addStaticMarker(a,d),addToPlacesList(d)}else alert('Ingen address hittad!')}geocoder.geocode({location:a},b)}function updateLocation(a,b,c){function d(b,d){if(d!==google.maps.GeocoderStatus.OK)return console.error(d),!1;if(b[2]){var e=b[2].formatted_address;a.setContent(createStaticMarkerContent(c,e)),updatePlaceList(c,e)}else alert('Ingen address hittad!')}geocoder.geocode({location:b},d)}function addToPath(a){path_coordinates.push({lat:a.lat(),lng:a.lng()}),path&&path.setMap(null),createPath(path_coordinates)}function updatePath(a){path_coordinates=[];for(i in a)path_coordinates.push({lat:a[i].getPosition().lat(),lng:a[i].getPosition().lng()});path&&path.setMap(null),createPath(path_coordinates)}function createPath(a){path=new google.maps.Polyline({path:a,geodesic:!0,strokeColor:'#FF0000',strokeOpacity:.5,strokeWeight:2}),path.setMap(map)}function findAddressLocation(a){geocoder.geocode({address:a},function(a,b){if(b!==google.maps.GeocoderStatus.OK)return console.error(b),!1;var c=a[0].geometry.location;map.setCenter(c),setMovableMarker(c)})}function addToPlacesList(a){var b=markers.length,c='';c+='<div class="col-xs-12 place" data-target="'+(b-1)+'">',c+='<h5>'+a+'</h5>',c+='</div>',$('#places-list').append(c)}function updatePlaceList(a,b){$('div[data-target="'+a+'"] h5').text(b)}function removeLocationAndMarker(a){$('.place[data-target="'+a+'"]').fadeOut(200,function(){$(this).remove()}),markers[a].setMap(null),delete markers[a],updatePath(markers),updateMarkerTitles(markers)}function updateMarkerTitles(a){var b=0;for(var c in a){var d=0===b?'Resan startar här':'Resmål nummer '+b;a[c].setTitle(d),b+=1}}var map,geocoder,path,path_coordinates=[],center_lat=59.317305,center_lng=18.034087,movable_marker,markers=[],standardMarker=new google.maps.MarkerImage('/px/marker_member-44x60-2x.png',null,null,null,new google.maps.Size(22,30)),personMarker=new google.maps.MarkerImage('/px/marker_person-44x60-2x.png',null,null,null,new google.maps.Size(22,30));$(document).ready(function(){$('[data-toggle="offcanvas"]').click(function(){$('.row-offcanvas').toggleClass('active')}),$('#gmap').ready(function(){var a=new google.maps.LatLng(center_lat,center_lng),b={zoom:6,center:a};map=new google.maps.Map(document.getElementById('gmap'),b),geocoder=new google.maps.Geocoder;for(var c in markers)latlng=new google.maps.LatLng(markers[c].lat,markers[c].lng),addLocation(latlng);google.maps.event.addListener(map,'rightclick',function(a){setMovableMarker(a.latLng)}),$(document).on('click','#place_marker',function(a){movable_marker&&movable_marker.setMap(null),latlng=movable_marker.getPosition(),addLocation(latlng)}),$('#geocoding_form').on('submit',function(a){a.preventDefault();var b=$('#geocoding_form_address').val();findAddressLocation(b)}),$(document).on('click','.delete-marker',function(a){a.preventDefault();var b=$(this).attr('data-target');confirm('Radera resmål?')&&removeLocationAndMarker(b)})})});var styles=[{featureType:'water',elementType:'geometry',stylers:[{color:'#e9e9e9'},{lightness:17}]},{featureType:'landscape',elementType:'geometry',stylers:[{color:'#f5f5f5'},{lightness:20}]},{featureType:'road.highway',elementType:'geometry.fill',stylers:[{color:'#ffffff'},{lightness:17}]},{featureType:'road.highway',elementType:'geometry.stroke',stylers:[{color:'#ffffff'},{lightness:29},{weight:.2}]},{featureType:'road.arterial',elementType:'geometry',stylers:[{color:'#ffffff'},{lightness:18}]},{featureType:'road.local',elementType:'geometry',stylers:[{color:'#ffffff'},{lightness:16}]},{featureType:'poi',elementType:'geometry',stylers:[{color:'#f5f5f5'},{lightness:21}]},{featureType:'poi.park',elementType:'geometry',stylers:[{color:'#dedede'},{lightness:21}]},{elementType:'labels.text.stroke',stylers:[{visibility:'on'},{color:'#ffffff'},{lightness:16}]},{elementType:'labels.text.fill',stylers:[{saturation:36},{color:'#333333'},{lightness:40}]},{elementType:'labels.icon',stylers:[{visibility:'off'}]},{featureType:'transit',elementType:'geometry',stylers:[{color:'#f2f2f2'},{lightness:19}]},{featureType:'administrative',elementType:'geometry.fill',stylers:[{color:'#fefefe'},{lightness:20}]},{featureType:'administrative',elementType:'geometry.stroke',stylers:[{color:'#fefefe'},{lightness:17},{weight:1.2}]}];